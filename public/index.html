<script>
// Autohome CSV 表示（フォルダ構造そのまま）
(async()=>{
  const status = document.getElementById('ah-status');
  try {
    const r = await fetch(
      "output/pipeline/autohome-ranking-csvs/autohome_ranking_with_image_urls_with_maker_with_maker_ja.csv",
      { cache: "no-store" }
    );
    if (!r.ok) throw new Error("HTTP " + r.status);

    const text = await r.text();
    const lines = text.trim().split(/\r?\n/);
    const head = lines.shift().split(",");
    const tbody = document.querySelector("#ah-table tbody");
    tbody.innerHTML = "";

    for (const line of lines) {
      if (!line.trim()) continue;
      const cols = line.split(",");
      const row = {};
      head.forEach((h, i) => (row[h] = cols[i]));

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.rank || ""}</td>
        <td>${row.model || ""}</td>
        <td>${row.manufacturer_ja || row.manufacturer || ""}</td>
        <td>${row.price || ""}</td>
        <td>${row.date || ""}</td>
      `;
      tbody.appendChild(tr);
    }

    status.className = "toast good";
    status.textContent = "Autohome CSV 読み込み成功";
  } catch (e) {
    status.className = "toast err";
    status.textContent = "Autohome CSV 読み込み失敗 (" + e.message + ")";
  }
})();
</script>
