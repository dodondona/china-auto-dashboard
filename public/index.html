<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>China Auto Dashboard</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      background: #f8f9fb;
      color: #222;
    }
    header {
      background: #004aad;
      color: #fff;
      padding: 0.8em 1.2em;
      text-align: center;
      font-size: 1.2em;
      font-weight: 600;
      letter-spacing: 0.03em;
    }
    main {
      padding: 1em;
      max-width: 100%;
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    th, td {
      padding: 8px 10px;
      border-bottom: 1px solid #eee;
      text-align: left;
      white-space: nowrap;
    }
    th {
      background: #f0f2f5;
      font-weight: 600;
    }
    tr:hover {
      background: #fafafa;
    }
    a.model-link {
      color: #004aad;
      text-decoration: none;
      font-weight: 500;
    }
    a.model-link:hover {
      text-decoration: underline;
    }
    .change-up { color: #00a000; font-weight: bold; }
    .change-down { color: #d00000; font-weight: bold; }
    .change-same { color: #888; }
    .toast {
      margin: 1em;
      padding: 0.6em 1em;
      border-radius: 5px;
      display: inline-block;
      font-size: 0.9em;
    }
    .toast.good {
      background: #e6f4ea;
      color: #1e6823;
      border: 1px solid #b8dfb9;
    }
    .toast.err {
      background: #fde4e4;
      color: #a22;
      border: 1px solid #f3b8b8;
    }
    @media (max-width: 768px) {
      table { font-size: 14px; }
      th, td { padding: 6px 8px; }
    }
  </style>
</head>
<body>

  <header>China Auto Dashboard ğŸš—</header>
  <div id="ah-status" class="toast">Autohome ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</div>

  <main>
    <table id="ah-table">
      <thead>
        <tr>
          <th>é †ä½</th>
          <th>å¤‰å‹•</th>
          <th>è»Šå</th>
          <th>ãƒ¡ãƒ¼ã‚«ãƒ¼</th>
          <th>å°æ•°</th>
          <th>ä¾¡æ ¼</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="6">èª­ã¿è¾¼ã¿ä¸­...</td></tr>
      </tbody>
    </table>
  </main>

  <script>
  (async()=>{
    const status = document.getElementById('ah-status');
    const tbody  = document.querySelector("#ah-table tbody");
    const csvPath = "output/pipeline/autohome-ranking-csvs/autohome_ranking_with_image_urls_with_maker_with_maker_ja.csv";

    try {
      const res = await fetch(csvPath, { cache: "no-store" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      const text = await res.text();

      const lines = text.trim().split(/\r?\n/);
      const head  = lines.shift().split(",");
      tbody.innerHTML = "";

      for (const line of lines) {
        if (!line.trim()) continue;
        const cols = line.split(",");
        const row  = {};
        head.forEach((h, i) => row[h.trim()] = cols[i]?.trim() ?? "");

        const rankNow = parseInt(row.rank || "0");
        const rankLast = parseInt(row.rank_last || "0");
        let diffTxt = "";
        let diffClass = "change-same";
        if (rankLast > 0) {
          const diff = rankLast - rankNow;
          if (diff > 0) { diffTxt = `â–²${diff}`; diffClass = "change-up"; }
          else if (diff < 0) { diffTxt = `â–¼${-diff}`; diffClass = "change-down"; }
          else diffTxt = "â€“";
        }

        const modelLink = row.series_url || row.url || "";
        const modelName = modelLink
          ? `<a href="${modelLink}" class="model-link" target="_blank" rel="noopener">${row.model}</a>`
          : row.model || "";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.rank || ""}</td>
          <td class="${diffClass}">${diffTxt}</td>
          <td>${modelName}</td>
          <td>${row.manufacturer_ja || row.manufacturer || ""}</td>
          <td>${row.sales || ""}</td>
          <td>${row.price || ""}</td>
        `;
        tbody.appendChild(tr);
      }

      status.className = "toast good";
      status.textContent = "Autohome CSV èª­ã¿è¾¼ã¿æˆåŠŸ âœ”";
    } catch (e) {
      console.error(e);
      status.className = "toast err";
      status.textContent = "Autohome CSV èª­ã¿è¾¼ã¿å¤±æ•— (" + e.message + ")";
      tbody.innerHTML = `<tr><td colspan="6">ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼</td></tr>`;
    }
  })();
  </script>

</body>
</html>
